{% extends "base.html" %}
{% load static %}
{% block content %}


<link rel="stylesheet" href="{% static 'css/list.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<form method="POST" enctype="multipart/form-data" class="p-4">
  {% csrf_token %}
  <div class="container my-4">
    <div class="container align-items-center">
      <h2 class="page-title"><i class="bi bi-cash-stack"></i> Importador de produtos</h2>
    </div>
    <input type="file" name="arquivo" class="form-control mb-3" accept=".xls,.xlsx,.csv">
    <button class="btn btn-primary w-100" id="btn-upload">
      <span class="spinner-border spinner-border-sm me-2 d-none" aria-hidden="true"></span>
      Importar
    </button>
    <div id="upload-progress" class="mt-3 d-none">
      <div class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"
          aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
</form>
<script>
  (() => {
    const form = document.querySelector('form.p-4');
    const btn = document.getElementById('btn-upload');
    const spin = btn?.querySelector('.spinner-border');
    const cont = document.getElementById('upload-progress');
    const bar = cont?.querySelector('.progress-bar');
    let timer = null;
    form?.addEventListener('submit', () => {
      if (btn) btn.disabled = true;
      if (spin) spin.classList.remove('d-none');
      if (cont) cont.classList.remove('d-none');
      let val = 0;
      timer = setInterval(() => {
        val = Math.min(val + Math.random() * 10 + 5, 95);
        if (bar) { bar.style.width = val + '%'; bar.setAttribute('aria-valuenow', String(Math.floor(val))); }
      }, 200);
    });
    window.addEventListener('beforeunload', () => { if (timer) clearInterval(timer); });
  })();
</script>
{% endblock %}