{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'css/form.css' %}">

<div class="container py-4">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="mb-0">Renegociação #{{ obj.rene_id }}</h3>
      <a href="{% url 'renegociacao_list' slug=slug %}" class="btn btn-secondary btn-sm">Voltar</a>
    </div>
    <div class="card-body">
      {% if erro %}
      <div class="alert alert-danger">{{ erro }}</div>
      {% endif %}

      <dl class="row">
        <dt class="col-sm-3">Empresa</dt>
        <dd class="col-sm-9">{{ obj.rene_empr }}</dd>

        <dt class="col-sm-3">Filial</dt>
        <dd class="col-sm-9">{{ obj.rene_fili }}</dd>

        <dt class="col-sm-3">Cliente</dt>
        <dd class="col-sm-9">{{ obj.rene_clie }}</dd>

        <dt class="col-sm-3">Data da renegociação</dt>
        <dd class="col-sm-9">{{ obj.rene_data }}</dd>

        <dt class="col-sm-3">Valor Original</dt>
        <dd class="col-sm-9">{{ obj.rene_valo }}</dd>

        <dt class="col-sm-3">Valor Final</dt>
        <dd class="col-sm-9">{{ obj.rene_vlfn }}</dd>

        <dt class="col-sm-3">Parcelas</dt>
        <dd class="col-sm-9">{{ obj.rene_parc }}</dd>

        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">{{ obj.rene_stat }}</dd>
      </dl>

      <div class="mt-3">
        <h6 class="mb-2">Títulos originais selecionados</h6>
        {% if titulos_originais %}
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Número</th>
                <th>Série</th>
                <th>Parcela</th>
                <th>Vencimento</th>
                <th>Valor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for t in titulos_originais %}
              <tr>
                <td>{{ t.titu_titu }}</td>
                <td>{{ t.titu_seri }}</td>
                <td>{{ t.titu_parc }}</td>
                <td>{{ t.titu_venc }}</td>
                <td>{{ t.titu_valo }}</td>
                <td>{{ t.titu_aber }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted small">Nenhum título original registrado.</p>
        {% endif %}
      </div>

      <div class="mt-3">
        <h6 class="mb-2">Títulos gerados pela renegociação (série REN)</h6>
        {% if titulos_gerados %}
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Número</th>
                <th>Série</th>
                <th>Parcela</th>
                <th>Vencimento</th>
                <th>Valor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for t in titulos_gerados %}
              <tr>
                <td>{{ t.titu_titu }}</td>
                <td>{{ t.titu_seri }}</td>
                <td>{{ t.titu_parc }}</td>
                <td>{{ t.titu_venc }}</td>
                <td>{{ t.titu_valo }}</td>
                <td>{{ t.titu_aber }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="mt-2 small text-muted">
          <strong>Datas das parcelas:</strong>
          {% for t in titulos_gerados %}
          <span class="badge bg-secondary">{{ t.titu_venc }}</span>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-muted small">Nenhum título gerado encontrado.</p>
        {% endif %}
      </div>

      <form method="post" class="mt-4">
        {% csrf_token %}
        <input type="hidden" name="acao" value="quebrar">
        <div class="mb-3">
          <label class="form-label">Observações para quebra de acordo</label>
          <textarea name="observacoes" class="form-control" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-danger">Quebrar acordo</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}