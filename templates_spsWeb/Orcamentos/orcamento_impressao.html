{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/ui.css' %}">
<link rel="stylesheet" href="{% static 'css/print.css' %}">

<div class="container py-4">
  <div class="text-center mb-4" role="banner" aria-label="Cabeçalho de impressão do orçamento">
    <h2 aria-label="Número do Orçamento">Orçamento #{{ object.pedi_nume }}</h2>
    <div class="meta">Data: {{ object.pedi_data|date:'d/m/Y' }}</div>
    <div class="meta">Cliente: {{ object.pedi_forn }}</div>
    <div class="meta">Vendedor: {{ object.pedi_vend }}</div>
    <div class="no-print mt-3" role="group" aria-label="Ações">
      <a class="btn btn-outline-secondary" href="{% url 'OrcamentosWeb:orcamentos_listar' slug=slug %}" aria-label="Voltar para lista">Voltar</a>
      <button class="btn btn-primary" onclick="window.print()" aria-label="Imprimir orçamento">Imprimir</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-sm table-bordered" aria-describedby="caption-itens-orc">
      <caption id="caption-itens-orc">Itens do orçamento com produto, quantidade, preço e total.</caption>
      <thead>
        <tr>
          <th scope="col">Item</th>
          <th scope="col">Produto</th>
          <th scope="col" class="text-end">Quantidade</th>
          <th scope="col" class="text-end">Preço Unitário</th>
          <th scope="col" class="text-end">Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens_detalhados %}
        <tr>
          <td>{{ item.iped_item }}</td>
          <td>
            <div style="display:flex; align-items:center; gap:8px;">
              {% if item.has_foto %}
                <img src="{% url 'produto_foto_web' slug=slug prod_codi=item.prod_codigo %}"
                     alt="Foto do produto {{ item.prod_nome }}" width="40" height="40"
                     style="object-fit:cover;" onerror="this.style.display='none';" />
              {% endif %}
              <div>
                <div style="font-weight:600;">{{ item.prod_nome }}</div>
                <div style="color:#666; font-size:12px;">{{ item.prod_codigo }}</div>
              </div>
            </div>
          </td>
          <td class="text-end">{{ item.iped_quan }}</td>
          <td class="text-end">R$ {{ item.iped_unit }}</td>
          <td class="text-end">R$ {{ item.iped_tota|default:0 }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th scope="row" colspan="4" class="text-end">Total do Orçamento</th>
          <th class="text-end">R$ {{ object.pedi_tota }}</th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<script>
  // Atalho acessível para imprimir (tecla P)
  (function(){
    document.addEventListener('keydown', function(e){
      if (e.altKey || e.ctrlKey || e.metaKey) return;
      if (e.key.toLowerCase() === 'p') { e.preventDefault(); window.print(); }
    });
  })();
</script>
{% endblock %}