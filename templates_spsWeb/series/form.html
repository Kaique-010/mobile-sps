{% extends "base.html" %}
{% load static %}

{% block title %}{% if form.instance.pk %}Editar Série{% else %}Cadastrar Série{% endif %}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/form.css' %}">
<div class="container py-4">
  <div class="card shadow-lg border-0">
    <div class="card-header text-center py-3">
      <h3 class="mb-0">{% if form.instance.pk %}Editar Série{% else %}Cadastrar Série{% endif %}</h3>
    </div>
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    <div class="card-body p-4">
      <form method="post" id="serie-form">
        {% csrf_token %}
        {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors|striptags }}</div>
        {% endif %}

        {% include "series/_form_fields.html" %}

        <div class="mt-3 form-actions">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <a class="btn btn-secondary" href="{% url 'series-list' slug=slug %}">Cancelar</a>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tipo = document.getElementById('id_seri_nome');
    var input = document.getElementById('id_seri_codi');
    var select = document.getElementById('seri_codi_pr');
    if (!tipo || !input || !select) return;
    function syncFromSelect() {
      input.value = select.value || input.value;
    }
    function toggleFields() {
      if (tipo.value === 'PR') {
        input.classList.add('d-none');
        select.classList.remove('d-none');
        if (!select.value && select.options.length) {
          select.value = select.options[0].value;
        }
        syncFromSelect();
      } else {
        select.classList.add('d-none');
        input.classList.remove('d-none');
      }
    }
    select.addEventListener('change', syncFromSelect);
    tipo.addEventListener('change', toggleFields);
    toggleFields();
  });
</script>
{% endblock %}