{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .cv-dark .card {
        border: 1px solid rgba(255, 255, 255, .08);
        color: #e8eef5;
    }

    .cv-dark .card .small,
    .cv-dark .card .text-muted {
        color: #a8b4c2 !important;
    }

    .cv-dark .badge {
        background: rgba(255, 255, 255, .12);
        color: #e8eef5;
    }

    .btn-green {
        background: #19c37d;
        color: #08121f;
        border: 0;
    }

    .btn-cyan {
        background: #22b7d8;
        color: #08121f;
        border: 0;
    }

    .progress-bar.bg-success {
        background: #19c37d;
    }

    .progress-bar.bg-warning {
        background: #f0ad4e;
    }

    .progress-bar.bg-info {
        background: #22b7d8;
    }

    .progress-bar.bg-primary {
        background: #5b8def;
    }

    .progress-bar.bg-danger {
        background: #ff6b6b;
    }

    .progress-bar.bg-indigo {
        background: #6c5ce7;
    }

    .progress-bar.bg-purple {
        background: #9b59b6;
    }

    .progress-bar.bg-pink {
        background: #ff7eb6;
    }

    .progress-bar.bg-teal {
        background: #20c997;
    }

    .progress-bar.bg-amber {
        background: #ffc107;
    }

    .progress-bar.bg-brown {
        background: #8d6e63;
    }

    .progress-bar.bg-slate {
        background: #7f8c8d;
    }

    .badge.text-bg-indigo {
        background: #6c5ce7;
        color: #08121f;
    }

    .badge.text-bg-purple {
        background: #9b59b6;
        color: #08121f;
    }

    .badge.text-bg-pink {
        background: #ff7eb6;
        color: #08121f;
    }

    .badge.text-bg-teal {
        background: #20c997;
        color: #08121f;
    }

    .badge.text-bg-amber {
        background: #ffc107;
        color: #08121f;
    }

    .badge.text-bg-brown {
        background: #8d6e63;
        color: #e8eef5;
    }

    .badge.text-bg-slate {
        background: #7f8c8d;
        color: #e8eef5;
    }

    .card-funil {
        border-width: 1px;
    }

    .card-funil.border-success {
        border-color: #19c37d !important;
        box-shadow: 0 15px 30px -5px rgba(25, 195, 125, 0.5);
    }

    .card-funil.border-warning {
        border-color: #f0ad4e !important;
        box-shadow: 0 15px 30px -5px rgba(240, 173, 78, 0.5);
    }

    .card-funil.border-info {
        border-color: #22b7d8 !important;
        box-shadow: 0 15px 30px -5px rgba(34, 183, 216, 0.5);
    }

    .card-funil.border-primary {
        border-color: #5b8def !important;
        box-shadow: 0 15px 30px -5px rgba(91, 141, 239, 0.5);
    }

    .card-funil.border-danger {
        border-color: #ff6b6b !important;
        box-shadow: 0 15px 30px -5px rgba(255, 107, 107, 0.5);
    }

    .card-funil.border-indigo {
        border-color: #6c5ce7 !important;
        box-shadow: 0 15px 30px -5px rgba(108, 92, 231, 0.5);
    }

    .card-funil.border-purple {
        border-color: #9b59b6 !important;
        box-shadow: 0 15px 30px -5px rgba(155, 89, 182, 0.5);
    }

    .card-funil.border-pink {
        border-color: #ff7eb6 !important;
        box-shadow: 0 15px 30px -5px rgba(255, 126, 182, 0.5);
    }

    .card-funil.border-teal {
        border-color: #20c997 !important;
        box-shadow: 0 15px 30px -5px rgba(32, 201, 151, 0.5);
    }

    .card-funil.border-amber {
        border-color: #ffc107 !important;
        box-shadow: 0 15px 30px -5px rgba(255, 193, 7, 0.5);
    }

    .card-funil.border-brown {
        border-color: #8d6e63 !important;
        box-shadow: 0 15px 30px -5px rgba(141, 110, 99, 0.5);
    }

    .card-funil.border-slate {
        border-color: #7f8c8d !important;
        box-shadow: 0 15px 30px -5px rgba(127, 140, 141, 0.5);
    }

    .card-visita {
        border: 1px solid rgba(255, 255, 255, .08);
        background: rgba(30, 41, 59, 0.4);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }

    .card-visita:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        border-color: rgba(255, 255, 255, .2);
    }
</style>
<div class="container cv-dark py-2">
    <div class="row mb-3">
        <div class="col-12">
            <h3 class="text-center m-0">Controle de Visitas</h3>
        </div>
        <div class="col-md-12">
            <div class="d-flex justify-content-end gap-2">
                <a href="/web/{{ slug }}/controle-de-visitas/nova/" class="btn btn-green">Nova Visita</a>
                <a href="/web/{{ slug }}/controle-de-visitas/dashboard/" class="btn btn-cyan">Dashboard</a>
            </div>
        </div>
    </div>
    <div class="container 1 justify-content-center">
        <div class="row g-2 align-items-center mb-3">
            <div class="col-md-12">
                <form class="row g-2" method="get">
                    <div class="col-md-2"><input type="text" name="cliente" value="{{ request.GET.cliente }}"
                            placeholder="Cliente" class="form-control" /></div>
                    <div class="col-md-2"><input type="text" name="vendedor" value="{{ request.GET.vendedor }}"
                            placeholder="Vendedor" class="form-control" /></div>
                    <div class="col-md-2"><input type="text" name="etapa" value="{{ request.GET.etapa }}"
                            placeholder="Etapa" class="form-control" /></div>
                    <div class="col-md-2"><input type="date" name="data_inicio" value="{{ request.GET.data_inicio }}"
                            placeholder="Data Início" class="form-control" /></div>
                    <div class="col-md-2"><input type="date" name="data_fim" value="{{ request.GET.data_fim }}"
                            placeholder="Data Fim" class="form-control" /></div>
                    <div class="col-md-2"><button class="btn btn-outline-primary w-100">Filtrar</button></div>
                </form>
            </div>
        </div>

    </div>
    {% if funil %}
    <div class="container 3">
        <div class="row g-3 mb-3">
            {% for f in funil %}
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card card-funil border-{{ f.color }}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small text-muted">{{ f.label }}</span>
                            <span class="badge text-bg-{{ f.color }}">{{ f.qtd }}</span>
                        </div>
                        <div class="progress mt-2" style="height:6px;">
                            <div class="progress-bar bg-{{ f.color }}" role="progressbar" style="width: {{ f.perc }}%;">
                            </div>
                        </div>
                        <div class="small text-muted mt-1">{{ f.perc }}%</div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="row g-3">
            {% for v in visitas %}
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 card-visita">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span
                                class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-10">Nº{{ v.ctrl_numero }}</span>
                            <small class="text-muted">{{ v.ctrl_data }}</small>
                        </div>

                        <h6 class="card-title mb-3 text-truncate" title="{{ v.ctrl_cliente.enti_nome }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-person me-2 text-info" viewBox="0 0 16 16">
                                <path
                                    d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                            </svg>{{ v.ctrl_cliente.enti_nome }}
                        </h6>

                        <div class="small mb-2 text-muted">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-shop me-2" viewBox="0 0 16 16">
                                <path
                                    d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h-1a.5.5 0 0 1-.5-.5V9a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v5.5a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5V9a.5.5 0 0 1 .5-.5z" />
                            </svg>{{ v.ctrl_vendedor.enti_nome }}
                        </div>

                        <div class="small mb-3">
                            <span
                                class="badge bg-secondary bg-opacity-10 text-light border border-secondary border-opacity-10 w-100 text-start d-flex align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-flag me-2" viewBox="0 0 16 16">
                                    <path
                                        d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.004.004-.013.013-.041.04a2.898 2.898 0 0 0-.08.088c-.057.065-.128.148-.216.248a13.292 13.292 0 0 1-3.18 2.532 12.96 12.96 0 0 1-4.08 1.157V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.19 9.806 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                </svg>{{ v.ctrl_etapa.etap_descricao }}
                            </span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top-0 pt-0">
                        <div class="d-grid gap-2 d-md-flex justify-content-between">
                            <a class="btn btn-sm btn-outline-primary flex-grow-1"
                                href="/web/{{ slug }}/controle-de-visitas/resumo/{{ v.ctrl_id }}/">Abrir</a>
                            <button type="button" class="btn btn-sm btn-outline-success flex-grow-1"
                                onclick="abrirModalEtapa('{{ v.ctrl_id }}', '{{ v.ctrl_etapa.etap_id|default_if_none:'' }}')">
                                Alterar etapa
                            </button>
                        </div>
                        {% if v.ctrl_prox_visi %}
                        <div class="mt-2 text-center">
                            <small class="text-muted" style="font-size: 0.75rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor"
                                    class="bi bi-calendar-event me-1" viewBox="0 0 16 16">
                                    <path
                                        d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z" />
                                    <path
                                        d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                </svg>Próx.: {{ v.ctrl_prox_visi }}
                            </small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="alert alert-info">Nenhuma visita encontrada</div>
            </div>
            {% endfor %}
        </div>
        <div class="container-padinacao" style="margin-top: 1rem; align-items: center; display: flex; justify-content: center;">
        {% if is_paginated %}
        <nav class="mt-3">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link"
                        href="?page={{ page_obj.previous_page_number }}&cliente={{ request.GET.cliente|urlencode }}&vendedor={{ request.GET.vendedor|urlencode }}&etapa={{ request.GET.etapa|urlencode }}&data_inicio={{ request.GET.data_inicio|urlencode }}&data_fim={{ request.GET.data_fim|urlencode }}">Anterior</a>
                </li>
                {% endif %}
                <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
                {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link"
                        href="?page={{ page_obj.next_page_number }}&cliente={{ request.GET.cliente|urlencode }}&vendedor={{ request.GET.vendedor|urlencode }}&etapa={{ request.GET.etapa|urlencode }}&data_inicio={{ request.GET.data_inicio|urlencode }}&data_fim={{ request.GET.data_fim|urlencode }}">Próxima</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
    </div>

    {% include 'ControleDeVisitas/parcials/modal_alterar_etapa.html' %}

    {% endblock %}