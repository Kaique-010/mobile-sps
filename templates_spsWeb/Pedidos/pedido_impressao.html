{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/ui.css' %}">
<link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
  /* Ajuste de layout da folha para impressão/PDF */
  .sheet {
    max-width: 900px;
    margin: 0 auto;
    padding: 24px;
    color: #000;
    background: #fff;
    border: 1px solid #ddd;
  }
  .header { display:flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .title { font-size: 36px; font-weight: 700; }
  .meta { font-size: 14px; color: #333; }
  .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0; }
  .label { font-size: 12px; color: #666; }
  .value { font-size: 14px; font-weight: 600; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ddd; padding: 6px; }
  th { background: #f5f5f5; text-align: left; }
  td.num { text-align: right; }
  .container-dados { margin: 25px 15px 0; }
  .container-itens { margin: 25px 15px 0; padding: 24px; border: 1px solid #ddd; }
  @media print {
    .no-print { display: none !important; }
  }
</style>

<div class="sheet">
  <div class="header" role="banner" aria-label="Cabeçalho da impressão do pedido">
    <div class="title" aria-label="Número do Pedido">Pedido #{{ object.pedi_nume }}</div>
    <div class="no-print" role="group" aria-label="Ações">
      <a class="btn btn-sm btn-secondary" href="{% url 'PedidosWeb:pedidos_listar' slug=slug %}" aria-label="Voltar para lista">Voltar</a>
      <button class="btn btn-sm btn-primary" onclick="window.print()" aria-label="Imprimir pedido">Imprimir</button>
    </div>
  </div>

  <div class="container-dados">

  <div class="meta">Data: {{ object.pedi_data|date:'d/m/Y' }} | Empresa: {{ object.pedi_empr }} | Filial: {{ object.pedi_fili }}</div>

  <div class="grid">
    <div>
      <div class="label">Cliente</div>
      <div class="value">{{ cliente_nome|default:object.pedi_forn }}</div>
    </div>
    <div>
      <div class="label">Vendedor</div>
      <div class="value">{{ vendedor_nome|default:object.pedi_vend }}</div>
    </div>
  </div>
  </div>
  <div class="container-itens">
  <table aria-describedby="caption-itens">
    <caption id="caption-itens">Itens do pedido com produto, quantidade, preço e total.</caption>
    <thead>
      <tr>
        <th scope="col">Produto</th>
        <th scope="col" style="width: 100px;">Qtd</th>
        <th scope="col" style="width: 140px;">Preço Unit.</th>
        <th scope="col" style="width: 140px;">Total</th>
      </tr>
    </thead>
    <tbody>
      {% for item in itens_detalhados %}
      <tr>
        <td>
          <div style="display:flex; align-items:center; gap:8px;">
            {% if item.has_foto %}
              <img src="{% url 'produto_foto_web' slug=slug prod_codi=item.prod_codigo %}"
                   alt="Foto do produto {{ item.prod_nome }}" width="40" height="40"
                   style="object-fit:cover;" onerror="this.style.display='none';" />
            {% endif %}
            <div>
              <div style="font-weight:600;">{{ item.prod_nome }}</div>
              <div style="color:#666; font-size:12px;">{{ item.prod_codigo }}</div>
            </div>
          </div>
        </td>
        <td class="num">{{ item.iped_quan }}</td>
        <td class="num">R$ {{ item.iped_unit }}</td>
        <td class="num">R$ {{ item.iped_tota|default:0 }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" style="text-align:center; color:#666;">Nenhum item cadastrado para este pedido.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  <div style="display:flex; justify-content:flex-end; margin-top: 12px;">
    <div>
      <div class="label">Total do Pedido</div>
      <div class="value" style="font-size:16px;">R$ {{ object.pedi_tota }}</div>
    </div>
  </div>
</div>
<script>
  // Atalho acessível para imprimir (tecla P), sem interferir com outros atalhos
  (function(){
    document.addEventListener('keydown', function(e){
      if (e.altKey || e.ctrlKey || e.metaKey) return;
      if (e.key.toLowerCase() === 'p') { e.preventDefault(); window.print(); }
    });
  })();
</script>
{% endblock %}