
SEFAZ_MESSAGES = {
    100: "Autorizado o uso da NF-e",
    101: "Cancelamento de NF-e homologado",
    102: "Inutilização de número homologado",
    103: "Lote recebido com sucesso",
    104: "Lote processado",
    105: "Lote em processamento",
    106: "Lote não localizado",
    107: "Serviço em Operação",
    108: "Serviço Paralisado Momentaneamente (curto prazo)",
    109: "Serviço Paralisado sem Previsão",
    110: "Uso Denegado",
    111: "Consulta cadastro com uma ocorrência",
    112: "Consulta cadastro com mais de uma ocorrência",
    113: "SCAN desativado (Sefaz Virtual)",
    114: "SVC desativada (Sefaz Virtual de Contingência)",
    124: "EPEC Autorizado (Contingência)",
    128: "Lote de Evento Processado",
    135: "Evento registrado e vinculado a NF-e",
    136: "Evento registrado, mas não vinculado a NF-e",
    137: "Nenhum documento localizado para o Destinatário",
    138: "Documento localizado para o Destinatário",
    139: "Pedido de Download processado",
    140: "Download disponibilizado",
    142: "Ambiente de Contingência EPEC bloqueado para o Emitente",
    150: "Autorizado o uso da NF-e, autorização fora de prazo",
    151: "Cancelamento de NF-e homologado fora de prazo",
    155: "Cancelamento de NF-e homologado fora de prazo (extemporâneo)",
    201: "Rejeição: O numero máximo de numeração de NF-e a inutilizar ultrapassou o limite",
    202: "Rejeição: Falha no reconhecimento da autoria ou integridade do arquivo digital",
    203: "Rejeição: Emissor não habilitado para emissão de NF-e",
    204: "Rejeição: Duplicidade de NF-e",
    205: "Rejeição: NF-e está denegada na base de dados da SEFAZ",
    206: "Rejeição: NF-e já está inutilizada na base de dados da SEFAZ",
    207: "Rejeição: CNPJ do emitente inválido",
    208: "Rejeição: CNPJ do destinatário inválido",
    209: "Rejeição: IE do emitente inválida",
    210: "Rejeição: IE do destinatário inválida",
    211: "Rejeição: IE do substituto tributário inválida",
    212: "Rejeição: Data de emissão NF-e posterior a data de recebimento",
    213: "Rejeição: CNPJ-Base do Emitente difere do CNPJ-Base do Certificado Digital",
    214: "Rejeição: Tamanho da mensagem excedeu o limite estabelecido",
    215: "Rejeição: Falha no schema XML",
    216: "Rejeição: Chave de Acesso difere da cadastrada",
    217: "Rejeição: NF-e não consta na base de dados da SEFAZ",
    218: "Rejeição: NF-e já esta cancelada na base de dados da SEFAZ",
    219: "Rejeição: Circulação da NF-e verificada",
    220: "Rejeição: Prazo de Cancelamento Superior ao Previsto na Legislação",
    221: "Rejeição: Confirmado o recebimento da NF-e pelo destinatário",
    222: "Rejeição: Protocolo de Autorização de Uso difere do cadastrado",
    223: "Rejeição: CNPJ do transmissor do lote difere do CNPJ do transmissor da consulta",
    224: "Rejeição: A faixa inicial é maior que a faixa final",
    225: "Rejeição: Falha no Schema XML do lote de NFe",
    226: "Rejeição: Código da UF do Emitente diverge da UF autorizadora",
    227: "Rejeição: Erro na Chave de Acesso - Campo ID - falta a literal NFe",
    228: "Rejeição: Data de Emissão muito atrasada",
    229: "Rejeição: IE do emitente não informada",
    230: "Rejeição: IE do emitente não cadastrada",
    231: "Rejeição: IE do emitente não vinculada ao CNPJ",
    232: "Rejeição: IE do destinatário não informada",
    233: "Rejeição: IE do destinatário não cadastrada",
    234: "Rejeição: IE do destinatário não vinculada ao CNPJ",
    235: "Rejeição: Inscrição SUFRAMA inválida",
    236: "Rejeição: Chave de Acesso com dígito verificador inválido",
    237: "Rejeição: CPF do destinatário inválido",
    238: "Rejeição: Cabeçalho - Versão do arquivo XML superior a Versão vigente",
    239: "Rejeição: Cabeçalho - Versão do arquivo XML não suportada",
    240: "Rejeição: Cancelamento/Inutilização - Irregularidade Fiscal do Emitente",
    241: "Rejeição: Um número da faixa já foi utilizado",
    242: "Rejeição: Cabeçalho - Falha no Schema XML",
    243: "Rejeição: XML Mal Formado",
    244: "Rejeição: CNPJ do Certificado Digital difere do CNPJ da Matriz e do CNPJ do Emitente",
    245: "Rejeição: CNPJ Emitente não cadastrado",
    246: "Rejeição: CNPJ Destinatário não cadastrado",
    247: "Rejeição: Sigla da UF do Emitente diverge da UF autorizadora",
    248: "Rejeição: UF do Recibo diverge da UF autorizadora",
    249: "Rejeição: UF da Chave de Acesso diverge da UF autorizadora",
    250: "Rejeição: UF diverge da UF autorizadora",
    251: "Rejeição: UF/Município da Chave de Acesso diverge da UF/Município do Emitente",
    252: "Rejeição: Ambiente informado diverge do Ambiente de recebimento",
    253: "Rejeição: Digito Verificador da chave de acesso composta inválida",
    254: "Rejeição: NF-e complementar não possui NF referenciada",
    255: "Rejeição: NF-e complementar possui mais de uma NF referenciada",
    256: "Rejeição: Uma NF-e referenciada não pode ser a própria NF-e",
    257: "Rejeição: Solicitante não habilitado para emissão da NF-e",
    258: "Rejeição: CNPJ da consulta inválido",
    259: "Rejeição: CNPJ da consulta não cadastrado como contribuinte na UF",
    260: "Rejeição: IE da consulta inválida",
    261: "Rejeição: IE da consulta não cadastrada como contribuinte na UF",
    262: "Rejeição: UF não fornece consulta por CPF",
    263: "Rejeição: CPF da consulta inválido",
    264: "Rejeição: CPF da consulta não cadastrado como contribuinte na UF",
    265: "Rejeição: Sigla da UF da consulta difere da UF do Web Service",
    266: "Rejeição: Série utilizada não permitida no Web Service",
    267: "Rejeição: NF Complementar referencia uma NF-e inexistente",
    268: "Rejeição: NF Complementar referencia uma outra NF-e Complementar",
    269: "Rejeição: CNPJ Emitente da NF Complementar difere do CNPJ da NF Referenciada",
    270: "Rejeição: Código Município do Fato Gerador: dígito inválido",
    271: "Rejeição: Código Município do Fato Gerador: difere da UF do emitente",
    778: "Rejeição: Informado NCM inexistente",
    272: "Rejeição: Código Município do Emitente: dígito inválido",
    273: "Rejeição: Código Município do Emitente: difere da UF do emitente",
    274: "Rejeição: Código Município do Destinatário: dígito inválido",
    275: "Rejeição: Código Município do Destinatário: difere da UF do Destinatário",
    276: "Rejeição: Código Município da UF de Local de Retirada: dígito inválido",
    277: "Rejeição: Código Município da UF de Local de Retirada: difere da UF do Local de Retirada",
    278: "Rejeição: Código Município da UF de Local de Entrega: dígito inválido",
    279: "Rejeição: Código Município da UF de Local de Entrega: difere da UF do Local de Entrega",
    280: "Rejeição: Certificado Transmissor inválido",
    281: "Rejeição: Certificado Transmissor Data Validade",
    282: "Rejeição: Certificado Transmissor sem CNPJ",
    283: "Rejeição: Certificado Transmissor - erro Cadeia de Certificação",
    284: "Rejeição: Certificado Transmissor revogado",
    285: "Rejeição: Certificado Transmissor difere ICP-Brasil",
    286: "Rejeição: Certificado Transmissor erro no acesso a LCR",
    287: "Rejeição: Código Município do FG - ISSQN: dígito inválido",
    288: "Rejeição: Código Município do FG - ISSQN: difere da UF do emitente",
    289: "Rejeição: Código da UF informada diverge da UF solicitada",
    290: "Rejeição: Certificado Assinatura inválido",
    291: "Rejeição: Certificado Assinatura Data Validade",
    292: "Rejeição: Certificado Assinatura sem CNPJ",
    293: "Rejeição: Certificado Assinatura - erro Cadeia de Certificação",
    294: "Rejeição: Certificado Assinatura revogado",
    295: "Rejeição: Certificado Assinatura difere ICP-Brasil",
    296: "Rejeição: Certificado Assinatura erro no acesso a LCR",
    297: "Rejeição: Assinatura difere do calculado",
    298: "Rejeição: Assinatura difere do padrão do Projeto",
    299: "Rejeição: XML da área de cabeçalho com codificação diferente de UTF-8",
    539: "Rejeição: Duplicidade de NF-e com diferença na Chave de Acesso",
    600: "Rejeição: CSOSN incompatível na operação com Não Contribuinte",
    601: "Rejeição: CSOSN incompatível na operação com Contribuinte",
}

def get_sefaz_message(cstat, xmotivo_original=None):
    """
    Retorna uma mensagem amigável para o código de status da SEFAZ.
    Se o código não estiver mapeado, retorna o xMotivo original ou uma mensagem genérica.
    """
    try:
        cstat_int = int(cstat)
    except (ValueError, TypeError):
        return xmotivo_original or "Erro desconhecido da SEFAZ"

    msg = SEFAZ_MESSAGES.get(cstat_int)
    
    if msg:
        # Se tiver motivo original, podemos combinar ou apenas retornar a mensagem amigável
        # Vamos retornar a amigável + (código)
        return f"{msg} (Cód: {cstat_int})"
    
    return xmotivo_original or f"Erro não catalogado (Cód: {cstat_int})"
